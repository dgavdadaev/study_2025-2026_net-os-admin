---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Установка и настройка системы управления базами данных MariaDB"
author: "Авдадаев Джамал Геланиевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Введение

## Цель работы  

Приобретение практических навыков по установке и конфигурированию системы управления базами данных на примере программного обеспечения MariaDB.

# Процесс работы

## Установка MariaDB

### Установка необходимых пакетов

В систему были установлены пакеты MariaDB-сервера и клиентских утилит.  
В процессе установки загружены зависимости и сформирована рабочая среда для СУБД.

### Просмотр конфигурационных файлов

Конфигурационные файлы MariaDB расположены в каталогах `/etc/my.cnf.d` и `/etc/my.cnf`.  
Были просмотрены доступные конфигурации и определены основные директивы.

![Просмотр файлов каталога my.cnf.d](Screenshot_1.png){ #fig:001 width=80% }

Построчные пояснения содержимого основного файла конфигурации:

- Секция предназначена для чтения как клиентом, так и сервером.
- Параметры внутри группы применяются ко всем компонентам MariaDB.
- Определена группа `client-server`, где задаются общие настройки.
- Включается каталог с конфигурациями `/etc/my.cnf.d`, содержащий отдельные `.cnf` файлы.

### Запуск MariaDB и включение автозагрузки

После завершения установки MariaDB была запущена и добавлена в автозагрузку операционной системы.

![Запуск MariaDB и добавление в автозагрузку](Screenshot_2.png){ #fig:002 width=80% }

### Проверка работы MariaDB и прослушивания порта

Проверено, что MariaDB корректно слушает порт 3306, что подтверждает успешный запуск сервера.

### Настройка безопасности MariaDB

Был выполнен скрипт первичной безопасности.  
В ходе выполнения:

- установлен пароль для пользователя root (БД);
- отключён удалённый доступ root;
- удалены анонимные пользователи;
- удалена тестовая база данных;
- обновлены таблицы привилегий.

![Настройка безопасности MariaDB](Screenshot_3.png){ #fig:003 width=80% }

### Взаимодействие с MariaDB

Произведён вход в интерактивную оболочку.  
Просмотрены доступные клиентские команды и список системных баз данных.

![Список команд SQL-клиента](Screenshot_4.png){ #fig:004 width=80% }

В системе присутствуют следующие базы данных:

- information_schema  
- mysql  
- performance_schema  
- sys

## Конфигурация кодировки символов

### Просмотр статуса MariaDB

Отображён подробный статус MariaDB, включающий:

- идентификатор подключения;
- текущего пользователя;
- параметры SSL;
- используемый сокет;
- версию сервера;
- сведения о кодировках клиента, сервера и соединения;
- время работы сервера и статистические данные.

![Статус MariaDB](Screenshot_5.png){ #fig:005 width=80% }

### Создание конфигурации utf8

В каталоге `/etc/my.cnf.d` создан отдельный конфигурационный файл `utf8.cnf`, задающий кодировку по умолчанию для клиента и сервера.

![Файл конфигурации utf8.cnf](Screenshot_6.png){ #fig:006 width=80% }

### Перезапуск MariaDB и проверка

После перезапуска MariaDB статус сервера подтверждает смену кодировок на utf8, что свидетельствует о корректном применении настройки.

## Создание базы данных addressbook

### Создание базы и выбор её в работе

Была создана база данных `addressbook` с указанием кодировки UTF-8 и выбрана для дальнейшей работы.  
После создания база не содержит таблиц, что подтверждает вывод списка доступных таблиц.

![Создание базы данных и проверка её структуры](Screenshot_7.png){ #fig:007 width=80% }

### Создание таблицы city

В базе данных создана таблица `city` с двумя текстовыми полями: `name` и `city`.  
Таблица была заполнена тремя строками: Иванов (Москва), Петров (Сочи), Сидоров (Дубна).  
Вывод содержимого таблицы показывает корректное сохранение данных в кодировке UTF-8.

![Создание таблицы и заполнение данными](Screenshot_8.png){ #fig:008 width=80% }

Результат выполнения запроса `SELECT * FROM city` отображает три строки, каждая из которых содержит имя и соответствующий город. Это подтверждает успешное создание таблицы и корректность выполнения операций вставки данных.

## Создание пользователя и настройка его прав

### Создание пользователя

Был создан новый пользователь, предназначенный для работы с базой данных `addressbook`, и ему назначен пароль.

### Назначение прав

Пользователю предоставлены привилегии на просмотр, добавление, изменение и удаление данных в таблицах базы `addressbook`.  
После этого конфигурация прав была обновлена.

Структура таблицы `city` просмотрена с помощью команды `DESCRIBE` — она содержит два столбца `name` и `city` типа VARCHAR(40).

![Создание пользователя, назначение прав и просмотр структуры таблицы](Screenshot_9.png){ #fig:009 width=80% }

## Просмотр баз данных и таблиц

Список всех доступных баз данных был выведен с учётной записью администратора.  
Затем был просмотрен перечень таблиц внутри базы `addressbook` как под пользователем root, так и под созданным пользователем.

![Просмотр баз данных и таблиц](Screenshot_10.png){ #fig:010 width=80% }

## Работа с резервными копиями

### Создание каталога резервного копирования

На виртуальной машине создан каталог `/var/backup`, предназначенный для хранения копий баз данных.

### Создание резервных копий

Были выполнены следующие операции:

- создана обычная резервная копия базы `addressbook`;
- создана сжатая копия;
- создана сжатая копия с указанием даты и времени создания.

### Восстановление базы данных

База данных была успешно восстановлена как из несжатой копии, так и из сжатой версии при помощи инструмента `zcat`.

![Создание и восстановление резервных копий](Screenshot_11.png){ #fig:011 width=80% }

## Перенос конфигурации MariaDB и резервных копий в Vagrant-окружение

### Подготовка структуры каталогов

В каталоге `/vagrant/provision/server` был создан новый каталог `mysql`  
с подкаталогами для конфигурационных файлов MariaDB и резервных копий.

В соответствующие каталоги были скопированы:

- файл `utf8.cnf` из системного каталога MariaDB,
- резервные копии базы данных из `/var/backup`.

### Создание сценария автоматической установки

Создан исполняемый файл `mysql.sh`, предназначенный для автоматизации установки MariaDB, копирования конфигураций, выполнения начальной настройки и развертывания базы данных из резервной копии.

![Подготовка окружения и создание сценария mysql.sh](Screenshot_12.png){ #fig:012 width=80% }

# Итоги

## Вывод  
В ходе выполнения работы была создана база данных `addressbook`, сформирована таблица `city` и заполнена данными. Настроен пользователь с необходимыми правами доступа, выполнены операции резервного копирования и восстановления базы. Конфигурационные файлы и резервные копии были интегрированы в среду Vagrant для автоматизации последующих развёртываний. Все задания выполнены успешно, а результаты подтверждены соответствующими выводами MariaDB.

## Контрольные вопросы  

**1. Какая команда отвечает за настройки безопасности в MariaDB?**  
Команда `mysql_secure_installation` выполняет начальную настройку безопасности: установку пароля root, удаление анонимных пользователей, отключение удалённого доступа и удаление тестовой базы.

**2. Как настроить MariaDB для доступа через сеть?**  
Необходимо изменить параметр `bind-address` в конфигурации MariaDB, задав IP-адрес, к которому разрешено подключение, либо значение `0.0.0.0` для приёма подключений со всех сетей. После изменения требуется перезапуск сервиса.

**3. Какая команда позволяет получить обзор доступных баз данных после входа в среду оболочки MariaDB?**  
Команда `SHOW DATABASES` выводит список всех доступных баз данных.

**4. Какая команда позволяет узнать, какие таблицы доступны в базе данных?**  
Команда `SHOW TABLES` выводит перечень таблиц текущей выбранной базы данных.

**5. Какая команда позволяет узнать, какие поля доступны в таблице?**  
Команда `DESCRIBE table_name` отображает структуру таблицы, имена полей и их типы.

**6. Какая команда позволяет узнать, какие записи доступны в таблице?**  
Команда `SELECT * FROM table_name` выводит все записи таблицы.

**7. Как удалить запись из таблицы?**  
Удаление выполняется через команду `DELETE FROM table_name WHERE условие`, где условие определяет удаляемую строку.

**8. Где расположены файлы конфигурации MariaDB? Что можно настроить с их помощью?**  
Основные конфигурационные файлы находятся в `/etc/my.cnf` и каталоге `/etc/my.cnf.d/`.  
Через них можно задавать параметры сервера и клиента: кодировку, сетевые настройки, каталоги хранения данных, параметры безопасности, подключение внешних файлов конфигураций.

**9. Где располагаются файлы с базами данных MariaDB?**  
Файлы баз данных находятся в каталоге `/var/lib/mysql`, где каждая база представлена отдельным подкаталогом.

**10. Как сделать резервную копию базы данных и затем её восстановить?**  
Резервная копия создаётся утилитой `mysqldump`, а восстановление проводится импортом SQL-файла в MariaDB. Возможны как обычные, так и сжатые варианты хранения копий.
